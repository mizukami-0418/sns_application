{% from "_formhelpers.html" import render_field %}
{% extends "base.html" %}
{% block title %}
ユーザー検索 - {{ super() }}
{% endblock %}
{% block content %}
<div class="container">
  <div class="bg-light text-success">
    <h1>ユーザー検索</h1>
  </div>
</div>
<div class="row">
  <div class="col-lg-12">
    <form method="POST">
      {{ form.csrf_token }}
      {{ render_field(form.username) }}
      {{ form.submit() }}
    </form>
  </div>
  <div class="col-lg-12">
    {% if users %}
    <table class="table table-striped">
      <thead>
        <tr>
          <th scope="col">#</th>
          <th scope="col">プロフィール画像</th>
          <th scope="col">ユーザー名</th>
          <th scope="col">フレンド申請or承認</th>
        </tr>
      </thead>
      <tbody>
        {% for user in users %}
        <tr>
          <th scope="col">{{ loop.index }}</th>
          {% if user.picture_path %}
          <th scope="col">
            {% set img_src = url_for('static', filename=user.picture_path) %}
            <img class="img-fluid" src="{{ img_src }}" alt="{{ user.username }}" style="max-width: 100px; max-height: 100px;">
          </th>
          {% else %}
          <th scope="col"></th>
          {% endif %}
          <th scope="col">{{ user.username }}</th>
          <th scope="col">
            {% if user.joined_status_from_to == 2 or user.joined_status_to_from == 2 %}
            フレンド
            {% elif user.joined_status_from_to == 1 %}
            フレンド申請中
            {% elif user.joined_status_to_from == 1 %}
            <form method="POST" action="{{ url_for('app.connect_user') }}">
              {{ connect_form.csrf_token }}
              {{ connect_form.connect_condition(value='accept') }}
              {{ connect_form.to_user_id(value=user.id) }}
              {{ connect_form.submit(class='btn btn-primary', value='フレンド承認')}}
            </form>
            {% else %}
            <form method="POST" action="{{ url_for('app.connect_user') }}">
              {{ connect_form.csrf_token }}
              {{ connect_form.connect_condition(value='connect') }}
              {{ connect_form.to_user_id(value=user.id) }}
              {{ connect_form.submit(class='btn btn-primary', value='フレンド申請する')}}
            </form>
            {% endif %}
          </th>
        </tr>
        {% endfor %}
      </tbody>
    </table>
    {% endif %}
  </div>
</div>
{% endblock %}