{# home.html #}
{% extends "base.html" %}
{% block title %}
home - {{ super() }}
{% endblock title %}
{% block content %}
<div class="row">
  {% if current_user.is_authenticated %}
  <div class="col-lg-4 offset-lg-2">
    {% if current_user.picture_path %}
      <img src="{{ url_for('static', filename=current_user.picture_path) }}"
      class="img-fluid" alt="User Picture">
    {% endif %}
  </div>
  <div class="col-lg-4">
    <p>ユーザー名：{{ current_user.username }}</p>
    <p>メールアドレス：{{ current_user.email }}</p>
  </div>
  <div class="container mt-4">
    <table class="table table-striped caption-top table-bordered border-primary">
      <caption class="bg-info text-white fw-bold text-xxl-center fs-2">フレンド一覧</caption>
      <thead>
        <tr>
          <th scope="col">#</th>
          <th scope="col">プロフィール画像</th>
          <th scope="col">ユーザー名</th>
          <th scope="col">メッセージ</th>
        </tr>
      </thead>
      <tbody>
      {% for friend in friends %}
        <tr>
          <td>{{ loop.index }}</td>
          {% if friend.picture_path %}
          {% set img_src = url_for('static', filename=friend.picture_path) %}
          <td><img class="img-fluid" src="{{ img_src }}" alt="{{ friend.username }}" style="max-width: 100px; max-height: 100px;"></td>
          {% else %}
          <td></td>
          {% endif %}
          <td>{{ friend.username }}</td>
          <td>メッセージ送信</td>
        </tr>
      {% endfor %}
      </tbody>
    </table>
  </div>
  <div class="container mt-4">
    <table class="table table-striped caption-top table-bordered border-primary">
      <caption class="bg-info text-white fw-bold text-xxl-center fs-2">フレンド申請リスト</caption>
      <thead>
        <tr>
          <th scope="col">#</th>
          <th scope="col">プロフィール画像</th>
          <th scope="col">ユーザー名</th>
          <th scope="col">フレンド申請状況</th>
        </tr>
      </thead>
      <tbody>
      {% for friend in requested_friends %}
      <tr>
        <td>{{ loop.index }}</td>
        {% if friend.picture_path %}
        {% set img_src = url_for('static', filename=friend.picture_path) %}
        <td><img class="img-fluid" src="{{ img_src }}" alt="{{ friend.username }}" style="max-width: 100px; max-height: 100px;"></td>
        {% else %}
        <td></td>
        {% endif %}
        <td>{{ friend.username }}</td>
        <td>
          <form method="POST" action="{{ url_for('app.connect_user')}}">
            {{ connect_form.csrf_token }}
            {{ connect_form.connect_condition(value='accept') }}
            {{ connect_form.to_user_id(value=friend.id) }}
            {{ connect_form.submit(class="btn btn-primary", value='フレンド申請承認') }}
          </form>
        </td>
      </tr>
      {% endfor %}
      </tbody>
    </table>
  </div>
  <div class="container mt-4">
    <table class="table table-striped caption-top table-bordered border-primary">
    <caption class="bg-info text-white fw-bold text-xxl-center fs-2">未承認フレンドリスト</caption>
      <thead>
        <tr>
          <th scope="col">#</th>
          <th scope="col">プロフィール画像</th>
          <th scope="col">ユーザー名</th>
        </tr>
      </thead>
      <tbody>
      {% for friend in requesting_friends %}
      <tr>
        <td>{{ loop.index }}</td>
        {% if friend.picture_path %}
        {% set img_src = url_for('static', filename=friend.picture_path) %}
        <td><img class="img-fluid" src="{{ img_src }}" alt="{{ friend.username }}" style="max-width: 100px; max-height: 100px;"></td>
        {% else %}
        <td></td>
        {% endif %}
        <td>{{ friend.username }}</td>
      </tr>
      {% endfor %}
      </tbody>
    </table>
  </div>
  
  {% else %}
  <div class="col-lg-8 offset-lg-2">
    <h1>ともトーク</h1>
    <p class="text-primary">ログイン or ユーザー登録をお願いします</p>
  </div>
  {% endif %}
</div>
{% for message in get_flashed_messages() %}
<div class="alert alert-info" role="alert">
  {{ message }}
</div>
{% endfor %}
{% endblock %}